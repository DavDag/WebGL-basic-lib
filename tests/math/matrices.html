<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Matrices tests</title>
  </head>
  <body style="margin: 0; padding: 0;">
    <pre id="results" style="margin: 0; padding: 2px;"></pre>

    <!-- Main -->
    <script type="module">
      const res = document.getElementById("results");

      // Execute a test suite
      function test(name, bArr) {
        res.innerHTML += "<i>" + name + "</i>: <br>";
        bArr.forEach((b, ind) => {
          if (ind % 4 === 0 && ind !== 0) res.innerHTML += "<br>";
          if (ind < 10) ind = "0" + ind;
          if (b()) {
            res.innerHTML += "#" + ind + " => ✅ ";
          } else {
            res.innerHTML += "#" + ind + " => ❌ ";
          }
        });
        res.innerHTML += "<br><br>";
      }

      // Compare two arrays
      function eq(v1, v2) {
        return v1.length === v2.length
          && v1.every((v, ind) => v2[ind] === v);
      }

      // Start testing matrices
      import {Vec2, Vec3} from "/src/all.js";
      import {Mat2, Mat3, Mat4} from "/src/all.js";
      import {toRad} from "/src/all.js";

      test("Types", [
        // [#0] Count
        () => {
          return Mat2.count() === 4 && Mat3.count() === 9 && Mat4.count() === 16;
        },
        
        // [#1] Side
        () => {
          return Mat2.side() === 2 && Mat3.side() === 3 && Mat4.side() === 4;
        }
      ]);

      test("Mat2 constructors", [
        // [#0] Default constructor
        () => {
          const a = new Mat2(1, 2, 3, 4);
          return eq(a.values, [1, 2, 3, 4]);
        },

        // [#1] Zeros
        () => {
          const a = Mat2.Zeros();
          return eq(a.values, new Array(4).fill(0));
        },

        // [#2] Ones
        () => {
          const a = Mat2.Ones();
          return eq(a.values, new Array(4).fill(1));
        },

        // [#3] All
        () => {
          const a = Mat2.All(2.5);
          return eq(a.values, new Array(4).fill(2.5));
        },

        // [#4] From array
        () => {
          const a = Mat2.FromArray([1, 2, 3, 4]);
          return eq(a.values, [1, 2, 3, 4]);
        },

        // [#5] Identity
        () => {
          const a = Mat2.Identity();
          return eq(a.values, [1, 0, 0, 1]);
        },
      ]);

      test("Mat3 constructors", [
        // [#0] Default constructor
        () => {
          const a = new Mat3(1, 2, 3,
                             1, 2, 3,
                             1, 2, 3);
          return eq(a.values, [1, 2, 3, 1, 2, 3, 1, 2, 3]);
        },

        // [#1] Zeros
        () => {
          const a = Mat3.Zeros();
          return eq(a.values, new Array(9).fill(0));
        },

        // [#2] Ones
        () => {
          const a = Mat3.Ones();
          return eq(a.values, new Array(9).fill(1));
        },

        // [#3] All
        () => {
          const a = Mat3.All(2.5);
          return eq(a.values, new Array(9).fill(2.5));
        },

        // [#4] From array
        () => {
          const a = Mat3.FromArray([1, 2, 3, 1, 2, 3, 1, 2, 3]);
          return eq(a.values, [1, 2, 3, 1, 2, 3, 1, 2, 3]);
        },

        // [#5] Identity
        () => {
          const a = Mat3.Identity();
          return eq(a.values, [1, 0, 0, 0, 1, 0, 0, 0, 1]);
        },
      ]);

      test("Mat4 constructors", [
        // [#0] Default constructor
        () => {
          const a = new Mat4(1, 2, 3, 4,
                             1, 2, 3, 4,
                             1, 2, 3, 4,
                             1, 2, 3, 4);
          return eq(a.values, [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]);
        },

        // [#1] Zeros
        () => {
          const a = Mat4.Zeros();
          return eq(a.values, new Array(16).fill(0));
        },

        // [#2] Ones
        () => {
          const a = Mat4.Ones();
          return eq(a.values, new Array(16).fill(1));
        },

        // [#3] All
        () => {
          const a = Mat4.All(2.5);
          return eq(a.values, new Array(16).fill(2.5));
        },

        // [#4] From array
        () => {
          const a = Mat4.FromArray([1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]);
          return eq(a.values, [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]);
        },

        // [#5] Identity
        () => {
          const a = Mat4.Identity();
          return eq(a.values, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
        },
      ]);

      test("Mat2 accessors", [
        // [#0] Get
        () => {
          const a = new Mat2(0,  1,  2,  3);
          return a.get(0, 0) === 0 && a.get(0, 1) === 1
            && a.get(1, 0) === 2 && a.get(1, 1) === 3;
        },
        
        // [#1] Set
        () => {
          const a = new Mat2(0,  1,  2,  3);
          a.set(0, 0, -1);
          a.set(1, 1, -1);
          return eq(a.values, [-1, 1, 2, -1]);
        },

        // [#2] Row
        () => {
          const a = new Mat2(0,  1,  2,  3);
          return eq(a.row(0).values, [0, 1]) && eq(a.row(1).values, [2, 3]);
        },

        // [#3] Col
        () => {
          const a = new Mat2(0,  1,  2,  3);
          return eq(a.col(0).values, [0, 2]) && eq(a.col(1).values, [1, 3]);
        }
      ]);

      test("Mat3 accessors", [
        // [#0] Get
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          return a.get(0, 0) === 0 && a.get(0, 1) === 1 && a.get(1, 0) === 3
            && a.get(1, 1) === 4 && a.get(1, 2) === 5 && a.get(2, 1) === 7
            && a.get(2, 2) === 8;
        },
        
        // [#1] Set
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.set(0, 0, -1);
          a.set(1, 1, -1);
          a.set(2, 2, -1);
          return eq(a.values, [-1, 1, 2, 3, -1, 5, 6, 7, -1]);
        },

        // [#2] Row
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          return eq(a.row(0).values, [0, 1, 2]) && eq(a.row(1).values, [3, 4, 5])
            && eq(a.row(2).values, [6, 7, 8]);
        },

        // [#3] Col
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          return eq(a.col(0).values, [0, 3, 6]) && eq(a.col(1).values, [1, 4, 7])
            && eq(a.col(2).values, [2, 5, 8]);
        }
      ]);

      test("Mat4 accessors", [
        // [#0] Get
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          return a.get(0, 0) === 0 && a.get(0, 1) === 1 && a.get(1, 0) === 4
            && a.get(1, 1) === 5 && a.get(1, 2) === 6 && a.get(2, 1) === 9
            && a.get(2, 2) === 10 && a.get(2, 3) === 11 && a.get(3, 2) === 14
            && a.get(3, 3) === 15;
        },
        
        // [#1] Set
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          a.set(0, 0, -1);
          a.set(1, 1, -1);
          a.set(2, 2, -1);
          a.set(3, 3, -1);
          return eq(a.values, [-1, 1, 2, 3, 4, -1, 6, 7, 8, 9, -1, 11, 12, 13, 14, -1]);
        },

        // [#2] Row
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          return eq(a.row(0).values, [0, 1, 2, 3]) && eq(a.row(1).values, [4, 5, 6, 7])
            && eq(a.row(2).values, [8, 9, 10, 11]) && eq(a.row(3).values, [12, 13, 14, 15]);
        },

        // [#3] Col
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          return eq(a.col(0).values, [0, 4, 8, 12]) && eq(a.col(1).values, [1, 5, 9, 13])
            && eq(a.col(2).values, [2, 6, 10, 14]) && eq(a.col(3).values, [3, 7, 11, 15]);
        }
      ]);

      test("Mat2 operations", [
        // [#0] Det
        () => {
          const a = new Mat2(0,  1,  2,  3);
          return a.det() === -2;
        },
        
        // [#1] Transpose
        () => {
          const a = new Mat2(0,  1,  2,  3);
          a.transpose();
          return eq(a.values, [0, 2, 1, 3]);
        },
        
        // [#2] Inverse
        () => {
          const a = new Mat2(0,  1,  2,  3);
          a.inverse();
          return eq(a.values, [-1.5, 0.5, 1, 0]);
        },
        
        // [#3] Translate
        () => {
          // Mat2 does not implement translate
          return true;
        },
        
        // [#4] Scale
        () => {
          const a = new Mat2(0,  1,  2,  3);
          a.scale(new Vec2(2, 3));
          return eq(a.values, [0, 3, 4, 9]);
        },
        
        // [#5] Rotate
        () => {
          const a = new Mat2(0,  1,  2,  3);
          a.rotate(toRad(90)).round(2);
          return eq(a.values, new Float32Array([1, 0, 3, -2]));
        },
        
        // [#6] Multiply
        () => {
          const a = new Mat2(0,  1,  2,  3);
          const b = new Mat2(0,  1,  2,  3);
          a.apply(b);
          return eq(a.values, [2, 3, 6, 11]);
        }
      ]);

      test("Mat3 operations", [
        // [#0] Det
        () => {
          const a = new Mat3(1, 3, 2,
                             1, 4, 3,
                             2, 2, 4);
          return a.det() === 4;
        },
        
        // [#1] Transpose
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.transpose();
          return eq(a.values, [0, 3, 6, 1, 4, 7, 2, 5, 8]);
        },
        
        // [#2] Inverse
        () => {
          const a = new Mat3(1, 1, 2,
                             3, 4, 2,
                             2, 3, 4);
          a.inverse().round(2);
          return eq(a.values, [2.5, 0.5, -1.5, -2, 0, 1, 0.25, -0.25, 0.25]);
        },
        
        // [#3] Translate
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.translate(Vec2.Ones());
          return eq(a.values, [0, 1, 3, 3, 4, 12, 6, 7, 21]);
        },
        
        // [#4] Scale
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.scale(new Vec3(2, 3, 4));
          return eq(a.values, [0, 3, 2, 6, 12, 5, 12, 21, 8]);
        },
        
        // [#5] Rotate
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.rotate(toRad(90)).round(2);
          return eq(a.values, new Float32Array([1, 0, 2, 4, -3, 5, 7, -6, 8]));
        },
        
        // [#6] Multiply
        () => {
          const a = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          const b = new Mat3(0, 1, 2,
                             3, 4, 5,
                             6, 7, 8);
          a.apply(b);
          return eq(a.values, [15, 18, 21, 42, 54, 66, 69, 90, 111]);
        }
      ]);

      test("Mat4 operations", [
        // [#0] Det
        () => {
          const a = new Mat4(1, 2, 3, 4,
                             2, 3, 5, 6,
                             1, 4, 5, 6,
                             2, 5, 6, 7);
          return a.det() === 2;
        },
        
        // [#1] Transpose
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          a.transpose();
          return eq(a.values, [0, 4, 8, 12, 1, 5, 9, 13, 2, 6, 10, 14, 3, 7, 11, 15]);
        },
        
        // [#2] Inverse
        () => {
          const a = new Mat4(1, 2, 3, 4,
                             2, 3, 5, 6,
                             1, 4, 5, 6,
                             2, 5, 6, 7);
          a.inverse();
          return eq(a.values, [ 0.5,  0, -1.5,  1,
                                0.5, -1, -0.5,  1,
                               -3.5,  2,  1.5, -1,
                                2.5, -1, -0.5,  0]);
        },
        
        // [#3] Translate
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          a.translate(Vec3.Ones());
          return eq(a.values, [0, 1, 2, 6, 4, 5, 6, 22, 8, 9, 10, 38, 12, 13, 14, 54]);
        },
        
        // [#4] Scale
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          a.scale(new Vec3(2, 3, 4));
          return eq(a.values, [ 0,  3,  8,  3,
                                8, 15, 24,  7,
                               16, 27, 40, 11,
                               24, 39, 56, 15]);
        },
        
        // [#5] Rotate
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          const axe = new Vec3(2, 3, 4).normalize();
          a.rotate(toRad(90), axe).round(2);
          return eq(a.values, new Float32Array([ 0.39, 1.88,  1.15,  3,
                                                 3.61, 4.12,  6.85,  7,
                                                 6.84, 6.36, 12.56, 11,
                                                10.06, 8.60, 18.27, 15]));
        },
        
        // [#6] Multiply
        () => {
          const a = new Mat4( 0,  1,  2,  3,
                              4,  5,  6,  7,
                              8,  9, 10, 11,
                             12, 13, 14, 15);
          const b = new Mat4( 0,  1,  2,  6,
                              4,  5,  6, 22,
                              8,  9, 10, 38,
                             12, 13, 14, 54);
          b.apply(a);
          return eq(b.values, [ 92, 101, 110,  119,
                               332, 369, 406,  443,
                               572, 637, 702,  767,
                               812, 905, 998, 1091]);
        }
      ]);

      test("Special operations", [
        // [#0] Look At
        () => {
          const a = Mat4.lookAt(new Vec3(0, 1, -1), new Vec3(1, 2, 3), new Vec3(0, 1, 0));
          a.round(2);
          return eq(a.values, new Float32Array([-0.97,     0,  0.24,  0.24,
                                                -0.06,  0.97, -0.23, -1.20,
                                                -0.24, -0.24, -0.94, -0.71,
                                                    0,     0,     0,     1]));
        }
      ])
    </script>
    <!--    -->
  </body>
</html>